{"version":3,"sources":["../../js/sign_in.js"],"names":["SignIn","props","state","isSignedIn","showing","invalidCredentials","loading","form","username","password","signOut","bind","signInPage","attemptSignIn","getFormErrors","setTimeout","signedIn","localStorage","token","undefined","send","setState","clear","fieldName","event","target","value","$","post","url","serverURL","data","done","find","val","response","userType","user_type","headers","_transport","fail","console","log","status","alert","name","characterLimit","customValidators","isValid","fieldValue","indexOf","errorMessage","formHasErrors","fieldErrors","complaint","length","handleEnterKeypress","key","getChangeHandler","SignInSpinner","className"],"mappings":"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","file":"sign_in.js","sourcesContent":["import React, { Component } from \"react\";\nimport App from \"./app\";\nimport validateForm from \"./form_validator\";\nimport { Transport } from \"lokka-transport-http\";\nimport { ipcRenderer } from \"electron\";\nimport settings from \"./settings\";\nimport graphql from \"./graphql\";\n\nimport {\n    Button,\n    Input,\n} from \"reactstrap\";\n\n\nclass SignIn extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            isSignedIn : false,\n            showing : true,\n            invalidCredentials : false,\n            loading : true,\n            form : {\n                username : \"\",\n                password : \"\",\n            },\n        };\n\n        this.signOut = this.signOut.bind(this);\n        this.signInPage = this.signInPage.bind(this);\n        this.attemptSignIn = this.attemptSignIn.bind(this);\n        this.getFormErrors = this.getFormErrors.bind(this);\n\n        // Fake initial loading\n        setTimeout(() => {\n            const signedIn = localStorage.token !== undefined;\n            ipcRenderer.send(\"signed-in\", signedIn);\n\n            this.setState({\n                loading : false,\n                isSignedIn : signedIn,\n                showing : !signedIn,\n            });\n        }, 700);\n    }\n\n    signOut() {\n        ipcRenderer.send(\"signed-in\", false);\n        localStorage.clear();\n\n        this.setState({\n            showing : true,\n            loading : true,\n        });\n\n        setTimeout(() => {\n            this.setState({\n                isSignedIn : false,\n                loading : false,\n            });\n        }, 500);\n    }\n\n    getChangeHandler(fieldName) {\n        const form = this.state.form;\n        return event => {\n            form[fieldName] = event.target.value;\n            this.setState({\n                invalidCredentials : false, //Remove invalid credentials on retry\n                form : form,\n            });\n        };\n    }\n\n    attemptSignIn() {\n        this.setState({\n            loading : true,\n        });\n\n        $.post({\n            url : `${settings.serverURL}/sign-in/`,\n            data : this.state.form,\n        }).done(response => {\n            $(\"#sign-in\").find(\"input\").val(\"\");\n            localStorage.token = response.token;\n            localStorage.username = response.username;\n            localStorage.userType = response.user_type;\n\n            const headers = { \"Authorization\" : `Token ${localStorage.token}` };\n            // Add headers to transport\n            graphql._transport = new Transport(`${settings.serverURL}/graphql/`, { headers });\n\n            ipcRenderer.send(\"signed-in\", true);\n\n            setTimeout(() => {\n                this.setState({\n                    isSignedIn : true,\n                    loading : false,\n                    showing : false,\n                    form : {\n                        username : \"\",\n                        password : \"\", //Reset fields\n                    },\n                });\n            }, 700);\n        }).fail((response) => {\n            console.log(response);\n\n            if (response.status === 401) {\n                this.setState({\n                    invalidCredentials : true,\n                    loading : false,\n                });\n                return;\n            }\n\n            alert(\"An error occurred connecting to the server.\");\n            this.setState({\n                loading : false,\n            });\n\n        });\n    }\n\n    getFormErrors() {\n        return validateForm([\n            {\n                name : \"Username\",\n                characterLimit : 30,\n                value : this.state.form.username,\n                customValidators : [{\n                    isValid : fieldValue => fieldValue.indexOf(\" \") === -1,\n                    errorMessage : fieldName => `${fieldName} should not have whitespaces`,\n                }],\n            },\n            {\n                name : \"Password\",\n                characterLimit : null,\n                value : this.state.form.password,\n            },\n        ]);\n    }\n\n    signInPage() {\n        const { formHasErrors, fieldErrors } = this.getFormErrors();\n\n        let complaint = null;\n\n        if (formHasErrors) {\n            if (fieldErrors[\"Password\"].length > 0) {\n                complaint = fieldErrors[\"Password\"][0];\n            }\n\n            if (fieldErrors[\"Username\"].length > 0) {\n                complaint = fieldErrors[\"Username\"][0];\n            }\n        }\n\n        if (this.state.invalidCredentials) {\n            complaint = \"Invalid Credentials\";\n        }\n\n        const handleEnterKeypress = (event) => {\n            if (event.key === \"Enter\" && !formHasErrors && !this.state.invalidCredentials) {\n                this.attemptSignIn();\n            }\n        };\n\n        return (\n            <div id=\"sign-in\"\n                 className={`bg-dlsu h-100 w-100 p-5 d-flex flex-column justify-content-center align-items-center ${this.state.showing ? \"showing\" : \"hidden\"}`}>\n\n                <div id=\"sign-in-contents\"\n                     className={`d-flex flex-column justify-content-center align-items-center ${this.state.showing ? \"signed-out\" : \"signed-in\"}`}>\n\n                    <div id=\"logo-set\"\n                         className=\"d-flex flex-row align-items-center mb-3\">\n                        <img src=\"./images/dlsu_white.png\"\n                             className=\"mr-5 dlsu-logo\"/>\n                        <h1 id=\"erio-logo\"\n                            className=\"text-white\">\n                            External Relations and Internationalization Office\n                        </h1>\n                    </div>\n\n                    <div className=\"d-flex align-items-center justify-content-between mt-5\">\n\n                        <SignInSpinner className={this.state.loading ? \"showing\" : \"hidden\"}/>\n\n                        <div id=\"sign-in-box\"\n                             className={`flex-column\n                                ${this.state.loading || this.state.isSignedIn ? \"hidden\" : \"showing\"}\n                                ${this.state.invalidCredentials ? \"shaking\" : \"\"}`}>\n\n                            <p className={`sign-in-feedback mb-3 text-center text-white ${complaint === null ? \"hidden\" : \"showing\"}`}>\n                                {complaint} &nbsp;\n                            </p>\n\n                            <Input className=\"bg-dlsu-lighter text-white border-0 mb-3\"\n                                   placeholder=\"Username\"\n                                   onChange={this.getChangeHandler(\"username\")}\n                                   onKeyPress={handleEnterKeypress}\n                                   value={this.state.form.username}/>\n\n                            <Input type=\"password\"\n                                   className=\"bg-dlsu-lighter text-white border-0 mb-3\"\n                                   placeholder=\"Password\"\n                                   onChange={this.getChangeHandler(\"password\")}\n                                   onKeyPress={handleEnterKeypress}\n                                   value={this.state.form.password}/>\n\n                            <Button outline\n                                    color=\"light\"\n                                    disabled={formHasErrors || this.state.invalidCredentials}\n                                    onClick={this.attemptSignIn}>\n                                Sign in\n                            </Button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n\n    render() {\n        return (\n            <div>\n                {this.signInPage()}\n                {this.state.isSignedIn && <App signOut={this.signOut}/>}\n            </div>\n        );\n    }\n\n}\n\nclass SignInSpinner extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        return (\n            <div id=\"sign-in-spinner\"\n                 className={this.props.className}>\n                <div className=\"spinner spinner-white spinner-lg\">\n                    <div className=\"bounce1\">\n\n                    </div>\n                    <div className=\"bounce2\">\n\n                    </div>\n                    <div className=\"bounce3\">\n\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default SignIn;"]}