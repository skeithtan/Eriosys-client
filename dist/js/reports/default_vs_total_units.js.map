{"version":3,"sources":["../../../js/reports/default_vs_total_units.js"],"names":["makeReportQuery","year","term","get","url","serverURL","beforeSend","data","OutboundDefaultVsTotalUnits","DefaultUnitsReport","props","state","institutions","error","fetchReport","bind","setState","done","fail","toString","parseInt","DefaultUnitsTable","rows","map","institution","index","totalStudents","totalDefault","grandTotalUnits","totalDeficit","forEach","students","defaultUnits","default_units","totalUnits","total_units","deficit","DefaultUnitsRow"],"mappings":"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","file":"default_vs_total_units.js","sourcesContent":["import React, { Component } from \"react\";\nimport settings from \"../settings\";\nimport authorizeXHR from \"../authorization\";\nimport {\n    EndOfReportIndicator,\n    GenericYearTermReport,\n    ReportHead,\n    ReportTitleContainer,\n} from \"../components/reports\";\nimport ErrorState from \"../components/error_state\";\nimport LoadingSpinner from \"../components/loading\";\nimport { Table } from \"reactstrap\";\nimport $ from \"jquery\";\n\n\nfunction makeReportQuery(year, term) {\n    return $.get({\n        url : `${settings.serverURL}/reports/outbound-units-reports/`,\n        beforeSend : authorizeXHR,\n        data : {\n            \"academic-year\" : year,\n            \"term\" : term,\n        },\n    });\n}\n\nclass OutboundDefaultVsTotalUnits extends GenericYearTermReport {\n    report(year, term) {\n        return <DefaultUnitsReport year={ year }\n                                   term={ term }/>;\n    }\n}\n\nclass DefaultUnitsReport extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            institutions : null,\n            error : null,\n        };\n\n        this.fetchReport = this.fetchReport.bind(this);\n        this.fetchReport(props.year, props.term);\n    }\n\n    fetchReport(year, term) {\n        if (this.state.error) {\n            this.setState({\n                error : null,\n            });\n        }\n\n        makeReportQuery(year, term)\n            .done(institutions => this.setState({\n                institutions : institutions,\n            }))\n            .fail(() => this.setState({\n                error : \"AJAX Error at fetchReport()\",\n            }));\n    }\n\n    componentWillReceiveProps(props) {\n        this.setState({\n            institutions : null,\n        });\n\n        this.fetchReport(props.year, props.term);\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <ErrorState onRetryButtonClick={ () => this.fetchReport(this.props.year, this.props.term) }>\n                    { this.state.error.toString() }\n                </ErrorState>\n            );\n        }\n\n        if (this.state.institutions === null) {\n            return <LoadingSpinner/>;\n        }\n\n        const year = parseInt(this.props.year);\n\n        return (\n            <div className=\"report-page\">\n                <ReportHead/>\n                <ReportTitleContainer>\n                    <h4>Term End Outbound and Inbound Students Distribution Report</h4>\n                    <h5>{ `Academic Year ${year} - ${year + 1} Term ${this.props.term}` }</h5>\n                </ReportTitleContainer>\n                <DefaultUnitsTable institutions={ this.state.institutions }/>\n                <EndOfReportIndicator/>\n            </div>\n        );\n    }\n}\n\nclass DefaultUnitsTable extends Component {\n    render() {\n        const rows = this.props.institutions.map((institution, index) =>\n            <DefaultUnitsRow institution={ institution }\n                             key={ index }/>,\n        );\n\n        let totalStudents = 0;\n        let totalDefault = 0;\n        let grandTotalUnits = 0;\n        let totalDeficit = 0;\n\n        this.props.institutions.forEach(institution => {\n            const students = institution.students;\n            const defaultUnits = institution.default_units;\n            const totalUnits = institution.total_units;\n            const deficit = defaultUnits - totalUnits;\n\n            totalStudents += students;\n            totalDefault += defaultUnits;\n            grandTotalUnits += totalUnits;\n            totalDeficit += deficit;\n        });\n\n        return (\n            <Table>\n                <thead>\n                <tr className=\"text-center\">\n                    <th>Institution</th>\n                    <th>Number of Students</th>\n                    <th>Default Units</th>\n                    <th>Total Units</th>\n                    <th>Deficit (-) / Surplus (+)</th>\n                </tr>\n                </thead>\n                <tbody>\n                { rows }\n                </tbody>\n                <tfoot className=\"text-right\">\n                <tr>\n                    <th>Total</th>\n                    <th className=\"numeric\">{ totalStudents }</th>\n                    <th className=\"numeric\">{ totalDefault }</th>\n                    <th className=\"numeric\">{ grandTotalUnits }</th>\n                    <th className=\"numeric\">{ totalDeficit }</th>\n                </tr>\n                </tfoot>\n            </Table>\n        );\n    }\n}\n\nclass DefaultUnitsRow extends Component {\n    render() {\n        const students = this.props.institution.students;\n        const defaultUnits = this.props.institution.default_units;\n        const totalUnits = this.props.institution.total_units;\n        const deficit = defaultUnits - totalUnits;\n\n        return (\n            <tr>\n                <td>{ this.props.institution.institution }</td>\n                <td className=\"numeric text-right\">{ students }</td>\n                <td className=\"numeric text-right\">{ defaultUnits }</td>\n                <td className=\"numeric text-right\">{ totalUnits }</td>\n                <td className=\"numeric text-right\">{ deficit }</td>\n            </tr>\n        );\n    }\n}\n\nexport default OutboundDefaultVsTotalUnits;"]}