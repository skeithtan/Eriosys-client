{"version":3,"sources":["../../../../../js/tabs/Archives/tabs/instititutions.js"],"names":["makeInstitutionsQuery","year","query","InstitutionArchives","props","state","activeYear","institutions","activeInstitutionId","error","performQuery","bind","setActiveYear","refreshInstitutions","setActiveInstitution","console","log","setState","then","result","forEach","institution","country","name","catch","setSidebarContent","id","toString","InstitutionArchivesTable","emptyState","length","rows","map","InstitutionArchivesRow","archiveDate","archived_at","format","className","isActive","onClick","archiver"],"mappings":";;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AACA;;AACA;;;;;;;;;;;;AAGA,SAASA,qBAAT,CAA+BC,IAA/B,EAAqC;AACjC,WAAO,kBAAQC,KAAR,mEAE2CD,IAF3C,8KAAP;AAaH;;IAEKE,mB;;;AACF,iCAAYC,KAAZ,EAAmB;AAAA;;AAAA,8IACTA,KADS;;AAGf,cAAKC,KAAL,GAAa;AACTC,wBAAa,wBAASL,IAAT,EADJ;AAETM,0BAAe,IAFN;AAGTC,iCAAsB,IAHb;AAITC,mBAAQ;AAJC,SAAb;;AAOA,cAAKC,YAAL,GAAoB,MAAKA,YAAL,CAAkBC,IAAlB,OAApB;AACA,cAAKC,aAAL,GAAqB,MAAKA,aAAL,CAAmBD,IAAnB,OAArB;AACA,cAAKE,mBAAL,GAA2B,MAAKA,mBAAL,CAAyBF,IAAzB,OAA3B;AACA,cAAKG,oBAAL,GAA4B,MAAKA,oBAAL,CAA0BH,IAA1B,OAA5B;;AAEA,cAAKD,YAAL,CAAkB,MAAKL,KAAL,CAAWC,UAA7B;AAfe;AAgBlB;;;;qCAEYL,I,EAAM;AAAA;;AACfc,oBAAQC,GAAR,CAAYf,IAAZ,EAAkB,KAAKI,KAAvB;;AAEA,gBAAI,KAAKA,KAAL,CAAWI,KAAf,EAAsB;AAClB,qBAAKQ,QAAL,CAAc;AACVR,2BAAQ;AADE,iBAAd;AAGH;;AAEDT,kCAAsBC,IAAtB,EACKiB,IADL,CACU,kBAAU;AACZC,uBAAOZ,YAAP,CAAoBa,OAApB,CAA4B,uBAAe;AACvC;AACAC,gCAAYC,OAAZ,GAAsBD,YAAYC,OAAZ,CAAoBC,IAA1C;AACH,iBAHD;;AAKA,uBAAKN,QAAL,CAAc;AACVV,kCAAeY,OAAOZ;AADZ,iBAAd;AAGH,aAVL,EAWKiB,KAXL,CAWW,iBAAS;AACZT,wBAAQC,GAAR,CAAYP,KAAZ;;AAEA,uBAAKL,KAAL,CAAWqB,iBAAX,CAA6B,IAA7B;AACA,uBAAKR,QAAL,CAAc;AACVR,2BAAQA;AADE,iBAAd;AAGH,aAlBL;AAmBH;;;sCAEaR,I,EAAM;AAChB,iBAAKgB,QAAL,CAAc;AACVX,4BAAaL,IADH;AAEVM,8BAAe,IAFL;AAGVC,qCAAsB;AAHZ,aAAd;;AAMA,iBAAKJ,KAAL,CAAWqB,iBAAX,CAA6B,IAA7B;AACA,iBAAKf,YAAL,CAAkBT,IAAlB;AACH;;;6CAEoBoB,W,EAAa;AAC9B,iBAAKJ,QAAL,CAAc;AACVT,qCAAsBa,YAAYK;AADxB,aAAd;;AAIA,iBAAKtB,KAAL,CAAWqB,iBAAX,CAA6B,uEAAwB,aAAaJ,WAArC;AACwB,kCAAkB,KAAKR,mBAD/C,GAA7B;AAEH;;;8CAEqB;AAClB,iBAAKD,aAAL,CAAmB,KAAKP,KAAL,CAAWC,UAA9B;AACH;;;iCAEQ;AAAA;;AACL,gBAAI,KAAKD,KAAL,CAAWI,KAAf,EAAsB;AAClB,uBACI;AAAA;AAAA,sBAAY,oBAAoB;AAAA,mCAAM,OAAKC,YAAL,CAAkB,OAAKL,KAAL,CAAWC,UAA7B,CAAN;AAAA,yBAAhC;AACK,yBAAKD,KAAL,CAAWI,KAAX,CAAiBkB,QAAjB;AADL,iBADJ;AAKH;;AAGD,mBACI;AAAA;AAAA,kBAAK,WAAU,0BAAf;AACI;AAAA;AAAA,sBAAc,eAAe,KAAKf,aAAlC;AACc,oCAAY,KAAKP,KAAL,CAAWC,UADrC;AAAA;AAAA,iBADJ;AAGI,8CAAC,wBAAD,IAA0B,cAAc,KAAKD,KAAL,CAAWE,YAAnD;AAC0B,gCAAY,KAAKF,KAAL,CAAWC,UADjD;AAE0B,uCAAmB,KAAKF,KAAL,CAAWqB,iBAFxD;AAG0B,yCAAqB,KAAKpB,KAAL,CAAWG,mBAH1D;AAI0B,0CAAsB,KAAKM,oBAJrD;AAHJ,aADJ;AAWH;;;;;;IAGCc,wB;;;AACF,sCAAYxB,KAAZ,EAAmB;AAAA;;AAAA,yJACTA,KADS;;AAGf,eAAKyB,UAAL,GAAkB,OAAKA,UAAL,CAAgBlB,IAAhB,QAAlB;AAHe;AAIlB;;;;qCAEY;AACT,mBACI;AAAA;AAAA,kBAAK,WAAU,mBAAf;AACI;AAAA;AAAA;AAAA;AAA4C,yBAAKP,KAAL,CAAWE;AAAvD;AADJ,aADJ;AAKH;;;iCAEQ;AAAA;;AACL,gBAAI,KAAKF,KAAL,CAAWG,YAAX,KAA4B,IAAhC,EAAsC;AAClC,uBAAO,sDAAP;AACH;;AAED,gBAAI,KAAKH,KAAL,CAAWG,YAAX,CAAwBuB,MAAxB,KAAmC,CAAvC,EAA0C;AACtC,uBAAO,KAAKD,UAAL,EAAP;AACH;;AAED,gBAAME,OAAO,KAAK3B,KAAL,CAAWG,YAAX,CAAwByB,GAAxB,CAA4B,uBAAe;AACpD,uBAAO,8BAAC,sBAAD,IAAwB,aAAaX,WAArC;AACwB,yBAAKA,YAAYK,EADzC;AAEwB,8BAAU,OAAKtB,KAAL,CAAWI,mBAAX,KAAmCa,YAAYK,EAFjF;AAGwB,6BAAS;AAAA,+BAAM,OAAKtB,KAAL,CAAWU,oBAAX,CAAgCO,WAAhC,CAAN;AAAA,qBAHjC,GAAP;AAIH,aALY,CAAb;;AAOA,mBACI;AAAA;AAAA,kBAAO,aAAP;AACO,+BADP;AAEI;AAAA;AAAA;AACA;AAAA;AAAA;AACI;AAAA;AAAA;AAAA;AAAA,yBADJ;AAEI;AAAA;AAAA;AAAA;AAAA,yBAFJ;AAGI;AAAA;AAAA;AAAA;AAAA,yBAHJ;AAII;AAAA;AAAA;AAAA;AAAA;AAJJ;AADA,iBAFJ;AAUI;AAAA;AAAA;AACCU;AADD;AAVJ,aADJ;AAgBH;;;;;;IAGCE,sB;;;AACF,oCAAY7B,KAAZ,EAAmB;AAAA;;AAAA,+IACTA,KADS;AAElB;;;;iCAEQ;AACL,gBAAMiB,cAAc,KAAKjB,KAAL,CAAWiB,WAA/B;AACA,gBAAMa,cAAc,sBAAOb,YAAYc,WAAnB,EAAgCC,MAAhC,CAAuC,KAAvC,CAApB;;AAEA,gBAAMC,YAAY,KAAKjC,KAAL,CAAWkC,QAAX,GAAsB,4BAAtB,GAAqD,IAAvE;;AAEA,mBACI;AAAA;AAAA,kBAAI,WAAWD,SAAf;AACI,6BAAS,KAAKjC,KAAL,CAAWmC,OADxB;AAEI;AAAA;AAAA;AAAKlB,gCAAYE;AAAjB,iBAFJ;AAGI;AAAA;AAAA;AAAKF,gCAAYC;AAAjB,iBAHJ;AAII;AAAA;AAAA;AAAKY;AAAL,iBAJJ;AAKI;AAAA;AAAA;AAAKb,gCAAYmB;AAAjB;AALJ,aADJ;AASH;;;;;;kBAGUrC,mB","file":"instititutions.js","sourcesContent":["import React, { Component } from \"react\";\nimport graphql from \"../../../graphql\";\nimport moment from \"moment\";\nimport ArchivesHead from \"../archive_head\";\nimport LoadingSpinner from \"../../../components/loading\";\nimport { Table } from \"reactstrap\";\nimport { InstitutionSidebarPane } from \"./sidebar_panes\";\nimport ErrorState from \"../../../components/error_state\";\n\n\nfunction makeInstitutionsQuery(year) {\n    return graphql.query(`\n    {\n        institutions(archived: true, year_archived: ${year}) {\n            id\n            name\n            country {\n                name\n            }\n            archived_at\n            archiver\n        }\n    }\n    `);\n}\n\nclass InstitutionArchives extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            activeYear : moment().year(),\n            institutions : null,\n            activeInstitutionId : null,\n            error : null,\n        };\n\n        this.performQuery = this.performQuery.bind(this);\n        this.setActiveYear = this.setActiveYear.bind(this);\n        this.refreshInstitutions = this.refreshInstitutions.bind(this);\n        this.setActiveInstitution = this.setActiveInstitution.bind(this);\n\n        this.performQuery(this.state.activeYear);\n    }\n\n    performQuery(year) {\n        console.log(year, this.state);\n\n        if (this.state.error) {\n            this.setState({\n                error : null,\n            });\n        }\n\n        makeInstitutionsQuery(year)\n            .then(result => {\n                result.institutions.forEach(institution => {\n                    //Make country = country.name for simplicity\n                    institution.country = institution.country.name;\n                });\n\n                this.setState({\n                    institutions : result.institutions,\n                });\n            })\n            .catch(error => {\n                console.log(error);\n\n                this.props.setSidebarContent(null);\n                this.setState({\n                    error : error,\n                });\n            });\n    }\n\n    setActiveYear(year) {\n        this.setState({\n            activeYear : year,\n            institutions : null,\n            activeInstitutionId : null,\n        });\n\n        this.props.setSidebarContent(null);\n        this.performQuery(year);\n    }\n\n    setActiveInstitution(institution) {\n        this.setState({\n            activeInstitutionId : institution.id,\n        });\n\n        this.props.setSidebarContent(<InstitutionSidebarPane institution={institution}\n                                                             onRestoreSuccess={this.refreshInstitutions}/>);\n    }\n\n    refreshInstitutions() {\n        this.setActiveYear(this.state.activeYear);\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <ErrorState onRetryButtonClick={() => this.performQuery(this.state.activeYear)}>\n                    {this.state.error.toString()}\n                </ErrorState>\n            );\n        }\n\n\n        return (\n            <div className=\"d-flex flex-column h-100\">\n                <ArchivesHead setActiveYear={this.setActiveYear}\n                              activeYear={this.state.activeYear}>Institution Archives</ArchivesHead>\n                <InstitutionArchivesTable institutions={this.state.institutions}\n                                          activeYear={this.state.activeYear}\n                                          setSidebarContent={this.props.setSidebarContent}\n                                          activeInstitutionId={this.state.activeInstitutionId}\n                                          setActiveInstitution={this.setActiveInstitution}/>\n            </div>\n        );\n    }\n}\n\nclass InstitutionArchivesTable extends Component {\n    constructor(props) {\n        super(props);\n\n        this.emptyState = this.emptyState.bind(this);\n    }\n\n    emptyState() {\n        return (\n            <div className=\"loading-container\">\n                <h3>There were no archived institutions in {this.props.activeYear}</h3>\n            </div>\n        );\n    }\n\n    render() {\n        if (this.props.institutions === null) {\n            return <LoadingSpinner/>;\n        }\n\n        if (this.props.institutions.length === 0) {\n            return this.emptyState();\n        }\n\n        const rows = this.props.institutions.map(institution => {\n            return <InstitutionArchivesRow institution={institution}\n                                           key={institution.id}\n                                           isActive={this.props.activeInstitutionId === institution.id}\n                                           onClick={() => this.props.setActiveInstitution(institution)}/>;\n        });\n\n        return (\n            <Table striped\n                   hover>\n                <thead>\n                <tr>\n                    <th>Name</th>\n                    <th>Country</th>\n                    <th>Archive Date</th>\n                    <th>Archived By</th>\n                </tr>\n                </thead>\n                <tbody>\n                {rows}\n                </tbody>\n            </Table>\n        );\n    }\n}\n\nclass InstitutionArchivesRow extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        const institution = this.props.institution;\n        const archiveDate = moment(institution.archived_at).format(\"LLL\");\n\n        const className = this.props.isActive ? \"bg-dlsu-lighter text-white\" : null;\n\n        return (\n            <tr className={className}\n                onClick={this.props.onClick}>\n                <td>{institution.name}</td>\n                <td>{institution.country}</td>\n                <td>{archiveDate}</td>\n                <td>{institution.archiver}</td>\n            </tr>\n        );\n    }\n}\n\nexport default InstitutionArchives;"]}