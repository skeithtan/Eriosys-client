{"version":3,"sources":["../../../../../js/tabs/Archives/tabs/sidebar_panes.js"],"names":["studentIsFetched","student","home_address","undefined","institutionIsFetched","institution","address","StudentSidebarPane","props","state","restoreStudentIsShowing","fetchStudent","bind","toggleRestoreStudent","id","studentId","error","setState","then","Object","assign","result","catch","toString","fullName","first_name","middle_name","family_name","isFetched","pageBody","onRestoreSuccess","InstitutionSidebarPane","confirmRestore","fetchInstitution","confirm","name","dismissToast","title","message","ajax","url","serverURL","method","beforeSend","done","success","fail","console","log","response"],"mappings":"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","file":"sidebar_panes.js","sourcesContent":["import React, { Component } from \"react\";\nimport LoadingSpinner from \"../../../components/loading\";\nimport {\n    RestoreInstitutionModal,\n    RestoreStudentModal,\n} from \"./modals\";\nimport $ from \"jquery\";\n\n\nimport {\n    ContactDetails as StudentContactDetails,\n    StudentDetails,\n    UniversityDetails,\n    makeStudentOverviewQuery,\n} from \"../../Students/tabs/overview\";\n\nimport {\n    StudentContact,\n    StudentDetailOverview,\n    StudentUniversity,\n} from \"../../Students/student_detail_overview\";\n\nimport {\n    ContactDetails as InstitutionContactDetails,\n    InstitutionDetails,\n    makeInstitutionOverviewQuery,\n} from \"../../Institutions/tabs/overview\";\nimport ErrorState from \"../../../components/error_state\";\nimport { makeInfoToast } from \"../../../dismissable_toast_maker\";\nimport authorizeXHR from \"../../../authorization\";\nimport settings from \"../../../settings\";\nimport iziToast from \"izitoast\";\n\n\nfunction studentIsFetched(student) {\n    return student.home_address !== undefined;\n}\n\nfunction institutionIsFetched(institution) {\n    return institution.address !== undefined;\n}\n\nclass StudentSidebarPane extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            restoreStudentIsShowing : false,\n            student : props.student,\n        };\n\n        this.fetchStudent = this.fetchStudent.bind(this);\n        this.toggleRestoreStudent = this.toggleRestoreStudent.bind(this);\n\n        if (!studentIsFetched(props.student)) {\n            this.fetchStudent(props.student.id);\n        }\n    }\n\n    fetchStudent(studentId) {\n        if (this.state.error) {\n            this.setState({\n                error : null,\n            });\n        }\n\n        makeStudentOverviewQuery(studentId)\n            .then(result => {\n                Object.assign(this.state.student, result.student);\n                this.setState({\n                    student : this.state.student,\n                });\n            })\n            .catch(error => this.setState({\n                error : error,\n            }));\n    }\n\n    toggleRestoreStudent() {\n        this.setState({\n            restoreStudentIsShowing : !this.state.restoreStudentIsShowing,\n        });\n    }\n\n    componentWillReceiveProps(props) {\n        this.setState({\n            student : props.student,\n        });\n\n        if (!studentIsFetched(props.student)) {\n            this.fetchStudent(props.student.id);\n        }\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <ErrorState onRetryButtonClick={() => this.fetchStudent(this.state.student.id)}>\n                    {this.state.error.toString()}\n                </ErrorState>\n            );\n        }\n\n        const student = this.state.student;\n        const fullName = `${student.first_name} ${student.middle_name} ${student.family_name}`;\n        const isFetched = studentIsFetched(student);\n\n        let pageBody;\n\n        if (isFetched) {\n            pageBody = (\n                <div className=\"page-body\">\n                    <StudentDetails sidebar\n                                    archived\n                                    toggleRestoreStudent={this.toggleRestoreStudent}\n                                    student={student}/>\n                    <StudentContactDetails sidebar\n                                           student={student}/>\n                    <UniversityDetails sidebar\n                                       student={student}/>\n                    <RestoreStudentModal student={student}\n                                         toggle={this.toggleRestoreStudent}\n                                         onRestoreSuccess={this.props.onRestoreSuccess}\n                                         isOpen={this.state.restoreStudentIsShowing}/>\n                </div>\n            );\n        } else {\n            pageBody = <LoadingSpinner/>;\n        }\n\n        return (\n            <div className=\"p-0 h-100 d-flex flex-column\">\n                <div className=\"page-head pt-5 d-flex flex-row align-items-end\">\n                    <div className=\"mr-auto\">\n                        <h5 className=\"mb-0\">{fullName}</h5>\n                    </div>\n                </div>\n\n                {pageBody}\n            </div>\n        );\n    }\n}\n\nclass InstitutionSidebarPane extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            institution : props.institution,\n            error : null,\n        };\n\n        this.confirmRestore = this.confirmRestore.bind(this);\n        this.fetchInstitution = this.fetchInstitution.bind(this);\n\n        if (!institutionIsFetched(props.institution)) {\n            this.fetchInstitution(props.institution.id);\n        }\n    }\n\n    fetchInstitution(id) {\n        if (this.state.error) {\n            this.setState({\n                error : null,\n            });\n        }\n\n        makeInstitutionOverviewQuery(id)\n            .then(result => {\n                //Copy results to existing institution object so we won't have to fetch next time\n                Object.assign(this.state.institution, result.institution);\n                this.setState({\n                    institution : this.state.institution,\n                });\n            })\n            .catch(error => this.setState({\n                error : error,\n            }));\n    }\n\n    confirmRestore() {\n        if (!confirm(`Would you like to restore ${this.props.institution.name}?`)) {\n            return;\n        }\n\n        const dismissToast = makeInfoToast({\n            title : \"Restoring\",\n            message : \"Restoring institution...\",\n        });\n\n        $.ajax({\n            url : `${settings.serverURL}/archives/institutions/${this.props.institution.id}/restore/`,\n            method : \"PUT\",\n            beforeSend : authorizeXHR,\n        }).done(() => {\n            dismissToast();\n            iziToast.success({\n                title : \"Success\",\n                message : \"Successfully restored institution\",\n            });\n\n            this.props.onRestoreSuccess();\n        }).fail(response => {\n            dismissToast();\n            console.log(response);\n            iziToast.error({\n                title : \"Error\",\n                message : \"Unable to restore memorandum\",\n            });\n        });\n    }\n\n    componentWillReceiveProps(props) {\n        this.setState({\n            institution : props.institution,\n        });\n\n        if (!institutionIsFetched(props.institution)) {\n            this.fetchInstitution(props.institution.id);\n        }\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <ErrorState onRetryButtonClick={() => this.fetchInstitution(this.state.institution.id)}>\n                    {this.state.error.toString()}\n                </ErrorState>\n            );\n        }\n\n        const institution = this.state.institution;\n        const isFetched = institutionIsFetched(institution);\n\n        let pageBody;\n\n        if (isFetched) {\n            pageBody = (\n                <div className=\"page-body\">\n                    <InstitutionDetails sidebar\n                                        archived\n                                        confirmRestore={this.confirmRestore}\n                                        institution={institution}/>\n                    <InstitutionContactDetails sidebar\n                                               institution={institution}/>\n                </div>\n            );\n        } else {\n            pageBody = <LoadingSpinner/>;\n        }\n\n        return (\n            <div className=\"p-0 h-100 d-flex flex-column\">\n                <div className=\"page-head pt-5 d-flex flex-row align-items-end\">\n                    <div className=\"mr-auto\">\n                        <h5 className=\"mb-0\">{institution.name}</h5>\n                    </div>\n                </div>\n\n                {pageBody}\n            </div>\n        );\n    }\n}\n\n\nexport {\n    StudentSidebarPane,\n    InstitutionSidebarPane,\n};"]}