{"version":3,"sources":["../../../../../js/tabs/Archives/tabs/sidebar_panes.js"],"names":["studentIsFetched","student","home_address","undefined","institutionIsFetched","institution","address","StudentSidebarPane","props","state","fetchStudent","bind","confirmRestore","id","fullName","first_name","middle_name","family_name","confirm","dismissToast","title","message","ajax","url","serverURL","method","beforeSend","done","success","onRestoreSuccess","fail","console","log","response","error","studentId","setState","then","Object","assign","result","catch","restoreStudentIsShowing","toString","isFetched","pageBody","InstitutionSidebarPane","fetchInstitution","name"],"mappings":"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","file":"sidebar_panes.js","sourcesContent":["import React, { Component } from \"react\";\nimport LoadingSpinner from \"../../../components/loading\";\nimport $ from \"jquery\";\n\n\nimport {\n    ContactDetails as StudentContactDetails,\n    StudentDetails,\n    UniversityDetails,\n    makeStudentOverviewQuery,\n} from \"../../Students/tabs/overview\";\n\nimport {\n    StudentContact,\n    StudentDetailOverview,\n    StudentUniversity,\n} from \"../../Students/student_detail_overview\";\n\nimport {\n    ContactDetails as InstitutionContactDetails,\n    InstitutionDetails,\n    makeInstitutionOverviewQuery,\n} from \"../../Institutions/tabs/overview\";\nimport ErrorState from \"../../../components/error_state\";\nimport { makeInfoToast } from \"../../../dismissable_toast_maker\";\nimport authorizeXHR from \"../../../authorization\";\nimport settings from \"../../../settings\";\nimport iziToast from \"izitoast\";\n\n\nfunction studentIsFetched(student) {\n    return student.home_address !== undefined;\n}\n\nfunction institutionIsFetched(institution) {\n    return institution.address !== undefined;\n}\n\nclass StudentSidebarPane extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            student : props.student,\n        };\n\n        this.fetchStudent = this.fetchStudent.bind(this);\n        this.confirmRestore = this.confirmRestore.bind(this);\n\n        if (!studentIsFetched(props.student)) {\n            this.fetchStudent(props.student.id);\n        }\n    }\n\n    confirmRestore() {\n        const student = this.props.student;\n        const fullName = `${student.first_name} ${student.middle_name} ${student.family_name}`;\n        if (!confirm(`Would you like to restore ${fullName}?`)) {\n            return;\n        }\n\n        const dismissToast = makeInfoToast({\n            title : \"Restoring\",\n            message : \"Restoring student...\",\n        });\n\n        $.ajax({\n            url : `${settings.serverURL}/archives/students/${this.props.student.id}/restore/`,\n            method : \"PUT\",\n            beforeSend : authorizeXHR,\n        }).done(() => {\n            dismissToast();\n            iziToast.success({\n                title : \"Success\",\n                message : \"Successfully restored student\",\n            });\n            this.props.onRestoreSuccess();\n        }).fail(response => {\n            dismissToast();\n            console.log(response);\n            iziToast.error({\n                title : \"Error\",\n                message : \"Unable to restore student\",\n            });\n        });\n    }\n\n    fetchStudent(studentId) {\n        if (this.state.error) {\n            this.setState({\n                error : null,\n            });\n        }\n\n        makeStudentOverviewQuery(studentId)\n            .then(result => {\n                Object.assign(this.state.student, result.student);\n                this.setState({\n                    student : this.state.student,\n                });\n            })\n            .catch(error => this.setState({\n                error : error,\n            }));\n    }\n\n    toggleRestoreStudent() {\n        this.setState({\n            restoreStudentIsShowing : !this.state.restoreStudentIsShowing,\n        });\n    }\n\n    componentWillReceiveProps(props) {\n        this.setState({\n            student : props.student,\n        });\n\n        if (!studentIsFetched(props.student)) {\n            this.fetchStudent(props.student.id);\n        }\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <ErrorState onRetryButtonClick={() => this.fetchStudent(this.state.student.id)}>\n                    {this.state.error.toString()}\n                </ErrorState>\n            );\n        }\n\n        const student = this.state.student;\n        const fullName = `${student.first_name} ${student.middle_name} ${student.family_name}`;\n        const isFetched = studentIsFetched(student);\n\n        let pageBody;\n\n        if (isFetched) {\n            pageBody = (\n                <div className=\"page-body\">\n                    <StudentDetails sidebar\n                                    archived\n                                    confirmRestore={this.confirmRestore}\n                                    student={student}/>\n                    <StudentContactDetails sidebar\n                                           student={student}/>\n                    <UniversityDetails sidebar\n                                       student={student}/>\n                </div>\n            );\n        } else {\n            pageBody = <LoadingSpinner/>;\n        }\n\n        return (\n            <div className=\"p-0 h-100 d-flex flex-column\">\n                <div className=\"page-head pt-5 d-flex flex-row align-items-end\">\n                    <div className=\"mr-auto\">\n                        <h5 className=\"mb-0\">{fullName}</h5>\n                    </div>\n                </div>\n\n                {pageBody}\n            </div>\n        );\n    }\n}\n\nclass InstitutionSidebarPane extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            institution : props.institution,\n            error : null,\n        };\n\n        this.confirmRestore = this.confirmRestore.bind(this);\n        this.fetchInstitution = this.fetchInstitution.bind(this);\n\n        if (!institutionIsFetched(props.institution)) {\n            this.fetchInstitution(props.institution.id);\n        }\n    }\n\n    fetchInstitution(id) {\n        if (this.state.error) {\n            this.setState({\n                error : null,\n            });\n        }\n\n        makeInstitutionOverviewQuery(id)\n            .then(result => {\n                //Copy results to existing institution object so we won't have to fetch next time\n                Object.assign(this.state.institution, result.institution);\n                this.setState({\n                    institution : this.state.institution,\n                });\n            })\n            .catch(error => this.setState({\n                error : error,\n            }));\n    }\n\n    confirmRestore() {\n        if (!confirm(`Would you like to restore ${this.props.institution.name}?`)) {\n            return;\n        }\n\n        const dismissToast = makeInfoToast({\n            title : \"Restoring\",\n            message : \"Restoring institution...\",\n        });\n\n        $.ajax({\n            url : `${settings.serverURL}/archives/institutions/${this.props.institution.id}/restore/`,\n            method : \"PUT\",\n            beforeSend : authorizeXHR,\n        }).done(() => {\n            dismissToast();\n            iziToast.success({\n                title : \"Success\",\n                message : \"Successfully restored institution\",\n            });\n\n            this.props.onRestoreSuccess();\n        }).fail(response => {\n            dismissToast();\n            console.log(response);\n            iziToast.error({\n                title : \"Error\",\n                message : \"Unable to restore memorandum\",\n            });\n        });\n    }\n\n    componentWillReceiveProps(props) {\n        this.setState({\n            institution : props.institution,\n        });\n\n        if (!institutionIsFetched(props.institution)) {\n            this.fetchInstitution(props.institution.id);\n        }\n    }\n\n    render() {\n        if (this.state.error) {\n            return (\n                <ErrorState onRetryButtonClick={() => this.fetchInstitution(this.state.institution.id)}>\n                    {this.state.error.toString()}\n                </ErrorState>\n            );\n        }\n\n        const institution = this.state.institution;\n        const isFetched = institutionIsFetched(institution);\n\n        let pageBody;\n\n        if (isFetched) {\n            pageBody = (\n                <div className=\"page-body\">\n                    <InstitutionDetails sidebar\n                                        archived\n                                        confirmRestore={this.confirmRestore}\n                                        institution={institution}/>\n                    <InstitutionContactDetails sidebar\n                                               institution={institution}/>\n                </div>\n            );\n        } else {\n            pageBody = <LoadingSpinner/>;\n        }\n\n        return (\n            <div className=\"p-0 h-100 d-flex flex-column\">\n                <div className=\"page-head pt-5 d-flex flex-row align-items-end\">\n                    <div className=\"mr-auto\">\n                        <h5 className=\"mb-0\">{institution.name}</h5>\n                    </div>\n                </div>\n\n                {pageBody}\n            </div>\n        );\n    }\n}\n\nexport {\n    StudentSidebarPane,\n    InstitutionSidebarPane,\n};"]}