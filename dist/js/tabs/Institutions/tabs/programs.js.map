{"version":3,"sources":["../../../../../js/tabs/Institutions/tabs/programs.js"],"names":["fetchYears","institutionID","onResult","query","then","fetchPrograms","Programs","props","state","yearList","programList","institution","id","currentYear","currentProgram","setCurrentYear","bind","setCurrentProgram","setState","result","programs","year","console","log","program","nextProps","ProgramsHead","years","map","Number","academic_year","academic_year_start","sort","a","b","getOrderedYears","index","name","length","ProgramsTable","ProgramsListSection","emptyState","rows","children"],"mappings":"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","file":"programs.js","sourcesContent":["import React, { Component } from \"react\";\nimport graphql from \"../../../graphql\";\nimport LoadingSpinner from \"../../../loading\";\nimport { Button } from \"reactstrap\";\nimport {\n    Section,\n    SectionRow,\n    SectionRowContent,\n    SectionTable,\n    SectionTitle,\n} from \"../../../components/section\";\n\nfunction fetchYears(institutionID, onResult) {\n    graphql.query(`\n    {\n        programs(institution:${institutionID}) {\n            academic_year {\n                academic_year_start\n            }\n        }\n    }\n    `).then(onResult);\n}\n\nfunction fetchPrograms(institutionID, onResult) {\n    graphql.query(`\n    {\n        programs(institution:${institutionID}) {\n            name\n        }\n    }\n    `).then(onResult);\n}\n\nclass Programs extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            yearList : null,\n            programList : null,\n            institutionID : props.institution.id,\n            currentYear : null,\n            currentProgram : null,\n        };\n\n        this.setCurrentYear = this.setCurrentYear.bind(this);\n        this.setCurrentProgram = this.setCurrentProgram.bind(this);\n\n        fetchYears(props.institution.id, result => {\n            this.setState({\n                yearList : result.programs,\n            });\n        });\n\n        fetchPrograms(props.institution.id, result => {\n            this.setState({\n                programList : result.programs,\n            });\n        });\n    }\n\n    setCurrentYear(year) {\n        console.log(year);\n        this.setState({\n            currentYear : year,\n        });\n    }\n\n    setCurrentProgram(program) {\n        this.setState({\n            currentProgram : program,\n        });\n    }\n\n    componentWillReceiveProps(nextProps) {\n        if (this.state.institutionID === nextProps.institution.id) {\n            return;\n        }\n\n        this.setState({\n            institutionID : nextProps.institution.id,\n            yearList : null,\n            programList : null,\n        });\n\n        fetchYears(nextProps.institution.id, result => {\n            this.setState({\n                yearList : result.programs,\n            });\n        });\n\n        fetchPrograms(nextProps.institution.id, result => {\n            this.setState({\n                programList : result.programs,\n            });\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"h-100 w-100\">\n                <ProgramsHead institution={ this.props.institution }\n                              years={ this.state.yearList }\n                              setCurrentYear={ this.setCurrentYear }/>\n                <ProgramsTable programs={ this.state.programList }\n                               setCurrentProgram={ this.setCurrentProgram }/>\n            </div>\n        );\n    }\n}\n\nclass ProgramsHead extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    getOrderedYears() {\n        if (this.props.years === null) {\n            return [];\n        }\n\n        let years = this.props.years.map(year => Number(year.academic_year.academic_year_start));\n        years = years.sort(function (a, b) {\n            return a - b;\n        });\n\n        return years;\n    }\n\n    toggleAddPrograms() {\n        //TODO\n    }\n\n    render() {\n        const years = this.getOrderedYears().map((year, index) => {\n            return <option key={ index } value={ year }>{ year } - { year + 1 }</option>;\n        });\n\n        return (\n            <div className=\"page-head pt-5 d-flex flex-row align-items-end\">\n                <div className=\"mr-auto\">\n                    <h5 className=\"mb-0 text-secondary\">Programs</h5>\n                    <h4 className=\"page-head-title mb-0\">{ this.props.institution.name }</h4>\n                </div>\n\n                <div className=\"page-head-actions\">\n                    { years.length !== 0 &&\n                    <select className=\"form-control mr-3\"\n                            onChange={ () => this.props.setCurrentYear }\n                            defaultValue={ this.getOrderedYears()[0] }>\n                        { years }\n                    </select> }\n                    <Button outline size=\"sm\" color=\"success\">\n                        Add a Program\n                    </Button>\n                </div>\n            </div>\n        );\n    }\n}\n\nclass ProgramsTable extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        return (\n            <div className=\"w-100\">\n                <ProgramsListSection programs={ this.props.programs }\n                                     setCurrentProgram={ this.props.setCurrentProgram }/>\n            </div>\n        );\n    }\n}\n\nclass ProgramsListSection extends Component {\n    constructor(props) {\n        super(props);\n\n        this.emptyState = this.emptyState.bind(this);\n    }\n\n    emptyState() {\n        // TODO\n        return (\n            <div>\n                This is empty\n            </div>\n        );\n    }\n\n    render() {\n        if (this.props.programs === null) {\n            return <LoadingSpinner/>;\n        }\n\n        if (this.props.programs.length === 0) {\n            return this.emptyState();\n        }\n\n        let rows = this.props.programs.map((program, index) => {\n            //TODO: onClick\n            return (\n                <SectionRow key={ index } onClick={ () => this.props.setCurrentProgram(program) }>\n                    <SectionRowContent large>{ program.name }</SectionRowContent>\n                </SectionRow>\n            );\n        });\n\n        return (\n            <div>\n                <Section>\n                    <SectionTitle>{ this.props.children }</SectionTitle>\n                    <SectionTable className=\"memorandums-accordion\">\n                        { rows }\n                    </SectionTable>\n                </Section>\n            </div>\n        );\n    }\n}\n\nexport default Programs;"]}