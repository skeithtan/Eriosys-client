{"version":3,"sources":["../../../../../js/tabs/Institutions/tabs/overview.js"],"names":["fetchInstitution","id","onResult","query","then","InstitutionOverview","props","state","institution","institutionID","setSidebarContent","onEditInstitution","bind","result","country","name","setState","nextProps","refreshInstitutions","onDeleteActiveInstitution","OverviewHead","deleteInstitutionIsShowing","editInstitutionIsShowing","toggleEditInstitution","toggleDeleteInstitution","onDeleteInstitution","OverviewBody","InstitutionDetails","agreementType","agreement","website","openWebsite","require","shell","openExternal","sidebar","address","archived","toggleRestoreInstitution","ContactDetails","noContactDetails","contact_person_number","length","contact_person_name","contact_person_email","default"],"mappings":"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","file":"overview.js","sourcesContent":["import React, { Component } from \"react\";\nimport LoadingSpinner from \"../../../components/loading\";\nimport graphql from \"../../../graphql\";\nimport { Button } from \"reactstrap\";\n\nimport {\n    ArchiveInstitutionModal,\n    InstitutionFormModal,\n} from \"../modals\";\n\nimport {\n    Section,\n    SectionTitle,\n    SectionTable,\n    SectionRow,\n    SectionRowTitle,\n    SectionRowContent,\n} from \"../../../components/section\";\n\n\nfunction fetchInstitution(id, onResult) {\n    graphql.query(`\n    {\n        institution(id:${id}) {\n            id\n            name\n            address\n            website\n            contact_person_email\n            contact_person_name\n            contact_person_number\n            country {\n                name\n            }\n            agreement\n        }\n    }    \n    `).then(onResult);\n}\n\nclass InstitutionOverview extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            institution : null,\n            institutionID : props.institution.id,\n        };\n\n        this.props.setSidebarContent(null);\n\n        this.onEditInstitution = this.onEditInstitution.bind(this);\n\n        //Fetch active institution details\n        fetchInstitution(props.institution.id, result => {\n            const institution = result.institution;\n\n            //Make country = country.name for simplicity\n            institution.country = institution.country.name;\n\n            this.setState({\n                institution : institution,\n            });\n        });\n    }\n\n    componentWillReceiveProps(nextProps) {\n        this.setState({\n            institutionID : nextProps.institution.id,\n            institution : null,\n        });\n\n        fetchInstitution(nextProps.institution.id, result => {\n            const institution = result.institution;\n\n            //Make country = country.name for simplicity\n            institution.country = institution.country.name;\n\n            this.setState({\n                institution : institution,\n            });\n        });\n    }\n\n    onEditInstitution() {\n        //Refresh and fetch new data from server\n        this.setState({\n            institution : null,\n        });\n\n        fetchInstitution(this.state.institutionID, result => {\n            const institution = result.institution;\n\n            //Make country = country.name for simplicity\n            institution.country = institution.country.name;\n\n            this.setState({\n                institution : institution,\n            });\n\n            this.props.refreshInstitutions();\n        });\n    }\n\n    render() {\n        //User has already selected, but we haven't fetched it from the database yet\n        if (this.state.institution === null) {\n            return <LoadingSpinner/>;\n        }\n\n        return (\n            <div className=\"d-flex flex-column p-0 h-100\">\n                <OverviewHead institution={this.state.institution}\n                              onDeleteInstitution={this.props.onDeleteActiveInstitution}\n                              onEditInstitution={this.onEditInstitution}/>\n                <OverviewBody institution={this.state.institution}/>\n            </div>\n        );\n    }\n}\n\nclass OverviewHead extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            deleteInstitutionIsShowing : false,\n            editInstitutionIsShowing : false,\n        };\n\n        this.toggleEditInstitution = this.toggleEditInstitution.bind(this);\n        this.toggleDeleteInstitution = this.toggleDeleteInstitution.bind(this);\n    }\n\n    toggleEditInstitution() {\n        this.setState({\n            editInstitutionIsShowing : !this.state.editInstitutionIsShowing,\n        });\n    }\n\n    toggleDeleteInstitution() {\n        this.setState({\n            deleteInstitutionIsShowing : !this.state.deleteInstitutionIsShowing,\n        });\n    }\n\n    render() {\n        return (\n            <div className=\"page-head pt-5 d-flex flex-row align-items-end\">\n                <div className=\"mr-auto\">\n                    <h5 className=\"mb-0 text-secondary\">Overview</h5>\n                    <h4 className=\"page-head-title mb-0\">{this.props.institution.name}</h4>\n                </div>\n\n                <div className=\"page-head-actions\">\n                    <Button outline\n                            size=\"sm\"\n                            color=\"success\"\n                            className=\"mr-2\"\n                            onClick={this.toggleEditInstitution}>Edit Institution</Button>\n                    <Button outline\n                            size=\"sm\"\n                            color=\"warning\"\n                            onClick={this.toggleDeleteInstitution}>Archive</Button>\n                </div>\n\n                <ArchiveInstitutionModal isOpen={this.state.deleteInstitutionIsShowing}\n                                         institution={this.props.institution}\n                                         toggle={this.toggleDeleteInstitution}\n                                         refresh={this.props.onDeleteInstitution}/>\n\n                <InstitutionFormModal edit\n                                      isOpen={this.state.editInstitutionIsShowing}\n                                      institution={this.props.institution}\n                                      refresh={this.props.onEditInstitution}\n                                      toggle={this.toggleEditInstitution}/>\n            </div>\n        );\n    }\n}\n\nclass OverviewBody extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        return (\n            <div className=\"page-body\">\n                <InstitutionDetails institution={this.props.institution}/>\n                <ContactDetails institution={this.props.institution}/>\n            </div>\n        );\n    }\n}\n\nclass InstitutionDetails extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        const institution = this.props.institution;\n        const agreementType = this.props.institution.agreement === \"B\" ? \"Bilateral\" : \"Multilateral\";\n        const website = `http://${institution.website}`;\n\n        function openWebsite() {\n            const { shell } = require(\"electron\");\n            shell.openExternal(website);\n        }\n\n        return (\n            <Section>\n                <SectionTitle>Institution details</SectionTitle>\n                <SectionTable>\n                    <SectionRow>\n                        <SectionRowTitle>Address</SectionRowTitle>\n                        <SectionRowContent large={!this.props.sidebar}>{institution.address}</SectionRowContent>\n                    </SectionRow>\n\n                    <SectionRow>\n                        <SectionRowTitle>Country</SectionRowTitle>\n                        <SectionRowContent large={!this.props.sidebar}>{institution.country}</SectionRowContent>\n                    </SectionRow>\n\n                    <SectionRow>\n                        <SectionRowTitle>Website</SectionRowTitle>\n                        <SectionRowContent large={!this.props.sidebar}\n                                           className=\"text-primary\"\n                                           onClick={openWebsite}>{website}</SectionRowContent>\n                    </SectionRow>\n\n                    <SectionRow>\n                        <SectionRowTitle>Agreement Type</SectionRowTitle>\n                        <SectionRowContent large={!this.props.sidebar}>{agreementType}</SectionRowContent>\n                    </SectionRow>\n\n                    {this.props.archived &&\n                    <SectionRow>\n                        <SectionRowContent className=\"d-flex\">\n                            <Button outline\n                                    color=\"primary\"\n                                    size=\"sm\"\n                                    className=\"ml-auto\"\n                                    onClick={this.props.toggleRestoreInstitution}>Restore</Button>\n                        </SectionRowContent>\n                    </SectionRow>\n                    }\n                </SectionTable>\n            </Section>\n        );\n    }\n}\n\nclass ContactDetails extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        const institution = this.props.institution;\n\n        const noContactDetails = institution.contact_person_number.length === 0\n            && institution.contact_person_name.length === 0\n            && institution.contact_person_email.length === 0;\n\n        if (noContactDetails) {\n            return null;\n        }\n\n        return (\n            <Section>\n                <SectionTitle>Contact Details</SectionTitle>\n                <SectionTable>\n                    {institution.contact_person_name.length > 0 &&\n                    <SectionRow>\n                        <SectionRowTitle>Contact Person</SectionRowTitle>\n                        <SectionRowContent large={!this.props.sidebar}>{institution.contact_person_name}</SectionRowContent>\n                    </SectionRow>\n                    }\n\n                    {institution.contact_person_email.length > 0 &&\n                    <SectionRow>\n                        <SectionRowTitle>Contact Person Email</SectionRowTitle>\n                        <SectionRowContent large={!this.props.sidebar}>{institution.contact_person_email}</SectionRowContent>\n                    </SectionRow>\n                    }\n\n                    {institution.contact_person_number.length > 0 &&\n                    <SectionRow>\n                        <SectionRowTitle>Contact Person Number</SectionRowTitle>\n                        <SectionRowContent large={!this.props.sidebar}>{institution.contact_person_number}</SectionRowContent>\n                    </SectionRow>\n                    }\n                </SectionTable>\n            </Section>\n        );\n    }\n}\n\n\nexport {\n    InstitutionOverview as default,\n    fetchInstitution,\n    InstitutionDetails,\n    ContactDetails,\n};"]}