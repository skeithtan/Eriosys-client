{"version":3,"sources":["../../../../../js/tabs/Students/tabs/resident_address_history.js"],"names":["fetchHistory","id","onResult","query","then","ResidentAddressHistory","props","state","student","studentId","residenceList","activeResidence","addResidenceIsShowing","editResidenceIsShowing","setState","result","residencies","refreshResidences","bind","setActiveResidence","toggleAddResidence","toggleEditResidence","residence","setSidebarContent","HistoryHead","first_name","middle_name","family_name","id_number","HistoryBody","emptyState","residences","length","sections","map","index","onResidenceRowClick","isActive","ResidenceRow","formatDate","date","format","dateEffective","date_effective","onClick","latest","address"],"mappings":"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","file":"resident_address_history.js","sourcesContent":["import React, { Component } from \"react\";\nimport moment from \"moment\";\nimport graphql from \"../../../graphql\";\nimport LoadingSpinner from \"../../../components/loading\";\n\nimport { Button, } from \"reactstrap\";\n\nimport {\n    Section,\n    SectionTitle,\n    SectionTable,\n    SectionRow,\n    SectionRowContent,\n    SectionRowTitle,\n} from \"../../../components/section\";\n\n// TODO: import modals for editing and adding\nimport { ResidenceSidebarPane } from \"./sidebar_panes\";\nimport { ResidenceAddressFormModal } from \"../modals\";\n\n\nfunction fetchHistory(id, onResult) {\n    graphql.query(`\n    {\n        student(id:${id}) {\n            id\n            id_number\n            first_name\n            middle_name\n            family_name\n            residencies {\n                id\n                date_effective\n                contact_person_name\n                contact_person_number\n                address\n                residence\n            }\n        }\n\t}\n\t`).then(onResult);\n}\n\nclass ResidentAddressHistory extends Component {\n    constructor(props) {\n        super(props);\n\n        this.state = {\n            student : props.student,\n            studentId : props.student.id,\n            residenceList : null,\n            activeResidence : null,\n            addResidenceIsShowing : false,\n            editResidenceIsShowing : false,\n        };\n\n        fetchHistory(this.state.studentId, result => {\n            this.setState({\n                residenceList : result.student.residencies,\n            });\n        });\n\n        this.refreshResidences = this.refreshResidences.bind(this);\n        this.setActiveResidence = this.setActiveResidence.bind(this);\n        this.toggleAddResidence = this.toggleAddResidence.bind(this);\n        this.toggleEditResidence = this.toggleEditResidence.bind(this);\n    }\n\n    toggleAddResidence() {\n        this.setState({\n            addResidenceIsShowing : !this.state.addResidenceIsShowing,\n        });\n    }\n\n    toggleEditResidence() {\n        this.setState({\n            editResidenceIsShowing : !this.state.editResidenceIsShowing,\n        });\n    }\n\n    setActiveResidence(residence) {\n        if (residence === null) {\n            this.props.setSidebarContent(null);\n        }\n\n        this.props.setSidebarContent(\n            <ResidenceSidebarPane toggleEditResidence={this.toggleEditResidence}\n                                  residence={residence}\n            />,\n        );\n\n        this.setState({\n            activeResidence : residence,\n        });\n\n    }\n\n    refreshResidences() {\n        fetchHistory(this.state.studentId, result => {\n            this.setState({\n                residenceList : result.student.residencies,\n            });\n        });\n    }\n\n    componentWillReceiveProps(props) {\n        if (this.state.studentId === props.student.id) {\n            return;\n        }\n\n        // If new student, clear sidebar\n        this.props.setSidebarContent(null);\n\n        this.setState({\n            studentId : props.student.id,\n            student : props.student,\n            activeResidence : null,\n            residenceList : null,\n        });\n\n        fetchHistory(props.student.id, result => {\n            this.setState({\n                residenceList : result.student.residencies,\n            });\n        });\n    }\n\n    render() {\n        if (this.state.student === null) {\n            return <LoadingSpinner/>;\n        }\n\n        return (\n            <div className=\"d-flex flex-column p-0 h-100\">\n                <HistoryHead student={this.state.student}\n                             toggleAddResidence={this.toggleAddResidence}/>\n\n                <HistoryBody residences={this.state.residenceList}\n                             activeResidence={this.state.activeResidence}\n                             setActiveResidence={this.setActiveResidence}/>\n\n                {\n                    //Keep the key because otherwise the ResidenceAddressFormModal\n                    // won't change when there's a new activeResidence\n                }\n                <ResidenceAddressFormModal edit\n                                           key={this.state.activeResidence === null ? 0 : this.state.activeResidence.id}\n                                           isOpen={this.state.editResidenceIsShowing}\n                                           student={this.state.student}\n                                           residence={this.state.activeResidence}\n                                           refreshResidences={this.refreshResidences}\n                                           toggle={this.toggleEditResidence}/>\n\n                <ResidenceAddressFormModal isOpen={this.state.addResidenceIsShowing}\n                                           student={this.state.student}\n                                           refreshResidences={this.refreshResidences}\n                                           toggle={this.toggleAddResidence}/>\n            </div>\n        );\n    }\n}\n\nclass HistoryHead extends Component {\n    constructor(props) {\n        super(props);\n\n    }\n\n    render() {\n        const student = this.props.student;\n\n        return (\n            <div className=\"page-head pt-5 d-flex flex-row align-items-end\">\n                <div className=\"mr-auto\">\n                    <h5 className=\"mb-0 text-secondary\">Resident Address History</h5>\n                    <h4 className=\"page-head-title mb-0\">\n                        {student.first_name} {student.middle_name} {student.family_name}\n                        <small className=\"text-muted ml-2\">{this.props.student.id_number}</small>\n                    </h4>\n                </div>\n\n                <div className=\"page-head-actions\">\n                    <Button outline\n                            size=\"sm\"\n                            color=\"success\"\n                            onClick={this.props.toggleAddResidence}>\n                        Add a Residence\n                    </Button>\n                </div>\n            </div>\n        );\n    }\n}\n\nclass HistoryBody extends Component {\n    constructor(props) {\n        super(props);\n\n        this.emptyState = this.emptyState.bind(this);\n    }\n\n    emptyState() {\n        return (\n            <div className=\"loading-container\">\n                <h3>There are no residences for this student</h3>\n            </div>\n        );\n    }\n\n    render() {\n        if (this.props.residences === null) {\n            return <LoadingSpinner/>;\n        }\n\n        if (this.props.residences.length === 0) {\n            return this.emptyState();\n        }\n\n        const sections = this.props.residences.map((residence, index) => {\n            const onResidenceRowClick = () => this.props.setActiveResidence(residence);\n\n            let isActive = false;\n\n            if (this.props.activeResidence !== null) {\n                isActive = this.props.activeResidence.id === residence.id;\n            }\n\n            return <ResidenceRow key={index}\n                                 residence={residence}\n                                 isActive={isActive}\n                                 onClick={onResidenceRowClick}\n                                 latest={index === 0}/>;\n        });\n\n        return (\n            <div className=\"page-body w-100\">\n                <div className=\"d-flex h-100 p-0 flex-row\">\n                    <div className=\"w-100\">\n                        <SectionTable>\n                            {sections}\n                        </SectionTable>\n                    </div>\n                </div>\n            </div>\n        );\n    }\n}\n\nclass ResidenceRow extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    render() {\n        const residence = this.props.residence;\n\n        function formatDate(date) {\n            return moment(date).format(\"LL\");\n        }\n\n        const dateEffective = formatDate(residence.date_effective);\n\n        return (\n            <Section>\n                <SectionTitle>{dateEffective}</SectionTitle>\n                <SectionRow selectable\n                            onClick={this.props.onClick}\n                            active={this.props.isActive}>\n                    {this.props.latest &&\n                    <SectionRowTitle>Latest Residence</SectionRowTitle>\n                    }\n                    <SectionRowContent large>{residence.address}</SectionRowContent>\n                </SectionRow>\n            </Section>\n        );\n    }\n}\n\nexport default ResidentAddressHistory;"]}